# สรุประบบจัดการพื้นที่เช่า (Rental Management System - M2)

## ภาพรวมระบบ

ระบบจัดการพื้นที่เช่า (M2) เป็นระบบจัดการค่าเช่าพื้นที่ที่ครอบคลุมการจัดการสัญญาเช่า การออกใบแจ้งหนี้ การชำระเงิน การจัดการค่าเช่าภายนอก และรายงานต่างๆ สำหรับร้านค้าที่เช่าพื้นที่ในปั๊ม (FIT Auto, Chester's, Daiso, Quick, ร้าน EV, ฯลฯ) ครอบคลุม 5 ปั๊ม (1 สำนักงานใหญ่ + 4 สาขา)

---

## ฟังก์ชันหลักทั้งหมด

### 1. Dashboard (หน้าหลัก)

**หน้าที่:** แสดงภาพรวมข้อมูลค่าเช่าทั้งหมดแบบเรียลไทม์

**ข้อมูลที่แสดง:**
- รายได้ค่าเช่าเดือนนี้ (เปรียบเทียบกับเดือนที่แล้ว)
- ค่าเช่าภายนอก (ค่าใช้จ่ายที่ปั๊มจ่ายออก)
- กำไรสุทธิ (รายได้ - ค่าใช้จ่าย)
- หนี้ค้างชำระ (จำนวนร้านและยอดรวม)
- รายได้ค่าเช่าแยกตามร้าน (FIT Auto, Chester's, Daiso, Quick, ร้าน EV, อื่นๆ) พร้อมประเภทค่าเช่า (คงที่ / % จากยอดขาย) และจำนวนสาขา
- หนี้ค้างชำระ (รายการร้านที่ค้างชำระ พร้อมจำนวนวันที่ค้าง)
- การชำระเงินล่าสุด (รายการการชำระเงินล่าสุด พร้อมวิธีชำระ: เงินสด, โอน, หักจากยอดขาย)
- สรุปการเงิน (รายได้ค่าเช่า, ค่าเช่าภายนอก, กำไรสุทธิ)
- ฟีเจอร์เพิ่มเติม (ลิงก์ไปยังฟีเจอร์อื่นๆ)

**Flow การทำงาน:**
1. ระบบดึงข้อมูลจาก Contracts, Invoices, Payments, ExternalRent
2. คำนวณสถิติแบบ Real-time
3. แสดงข้อมูลในรูปแบบ Summary Cards, Charts, และ Recent Activity Lists

---

### 2. แดชบอร์ดพื้นที่เช่า (Lease Dashboard)

**หน้าที่:** แสดงภาพรวมรายได้ค่าเช่า ค่าเช่าที่ต้องจ่าย และค้างชำระ

**ข้อมูลที่แสดง:**
- รายได้ค่าเช่าเดือนนี้ (เปรียบเทียบกับเดือนที่แล้ว)
- ค่าเช่าที่ต้องจ่าย (ค่าใช้จ่ายที่ปั๊มจ่ายออก)
- กำไรสุทธิ (รายได้ - ค่าใช้จ่าย)
- หนี้ค้าง (จำนวนรายการและยอดรวม)
- รายได้ค่าเช่าแยกร้าน (รายได้แยกตามร้าน พร้อมจำนวนสาขาและประเภทค่าเช่า)
- รายได้ค่าเช่าแยกสาขา (รายได้, ค่าใช้จ่าย, กำไรสุทธิ แยกตามสาขา)
- หนี้ค้างชำระ (รายการร้านที่ค้างชำระ)

**Flow การทำงาน:**
1. ระบบดึงข้อมูลจาก Contracts, Payments, ExternalRent
2. คำนวณสถิติแยกตามร้านและสาขา
3. แสดงข้อมูลในรูปแบบ Summary Cards และ Tables

---

### 3. สัญญาเช่า (Contracts)

**หน้าที่:** จัดการสัญญาเช่าพื้นที่แต่ละร้าน

**ข้อมูลที่เก็บ:**
- ชื่อร้าน (FIT Auto, Chester's, Daiso, Quick, ร้าน EV, ฯลฯ)
- สาขา (สำนักงานใหญ่, สาขา A, สาขา B, สาขา C, สาขา D)
- วันที่เริ่มสัญญา
- วันที่สิ้นสุดสัญญา
- ประเภทค่าเช่า (คงที่ / % จากยอดขาย)
- อัตราค่าเช่า (บาท/เดือน สำหรับค่าเช่าคงที่ หรือ % จากยอดขาย สำหรับค่าเช่าผันแปร)
- สถานะ (ใช้งาน)

**Flow การทำงาน:**
1. สร้างสัญญาเช่าใหม่:
   - เลือกร้านและสาขา
   - กำหนดวันที่เริ่มและสิ้นสุดสัญญา
   - เลือกประเภทค่าเช่า (คงที่ หรือ % จากยอดขาย)
   - ระบุอัตราค่าเช่า (ถ้าคงที่: บาท/เดือน, ถ้า % จากยอดขาย: % และระบบจะดึงยอดขายจาก M1 อัตโนมัติ)
   - บันทึกสัญญา
2. แก้ไขสัญญาเช่า:
   - เลือกสัญญาที่ต้องการแก้ไข
   - แก้ไขข้อมูลที่ต้องการ
   - บันทึกการแก้ไข
3. ลบสัญญาเช่า:
   - เลือกสัญญาที่ต้องการลบ
   - ยืนยันการลบ
4. กรองและค้นหา:
   - ค้นหาตามชื่อร้านหรือสาขา
   - กรองตามสาขา
   - กรองตามประเภทค่าเช่า

**สถิติที่แสดง:**
- สัญญาทั้งหมด
- ร้านทั้งหมด
- สัญญาค่าเช่าคงที่
- สัญญา % จากยอดขาย

---

### 4. ค่าเช่าผันแปร (Variable Rent)

**หน้าที่:** คำนวณค่าเช่าที่ผันแปรตามยอดขาย (ดึงจาก M1)

**ข้อมูลที่แสดง:**
- สัญญาค่าเช่าผันแปรทั้งหมด
- ยอดขายรวม (ดึงจาก M1)
- ค่าเช่ารวม (คำนวณอัตโนมัติ)
- เฉลี่ย % จากยอดขาย
- รายละเอียดสัญญาแต่ละรายการ:
  - ชื่อร้านและสาขา
  - อัตรา % จากยอดขาย
  - ยอดขายจาก M1
  - ค่าเช่าคำนวณ
  - ค่าเช่าเดือนที่แล้ว
  - การเปลี่ยนแปลง (เปอร์เซ็นต์และจำนวนเงิน)

**Flow การทำงาน:**
1. ระบบดึงยอดขายจาก M1 (Gas Station System) อัตโนมัติ
2. คำนวณค่าเช่าตามสูตร: ยอดขาย × % = ค่าเช่า
3. แสดงผลการคำนวณพร้อมเปรียบเทียบกับเดือนที่แล้ว
4. อัปเดตข้อมูลจาก M1 (ปุ่มอัปเดต)

**การเชื่อมต่อกับ M1:**
- ระบบจะดึงยอดขายร้าน (เช่น Chester's) จาก M1 อัตโนมัติทุกวัน
- คำนวณค่าเช่าตาม % ที่กำหนดในสัญญา
- ตัวอย่าง: Chester's ขาย 500,000 บาท × 5% = 25,000 บาท (ค่าเช่า)

---

### 5. ใบแจ้งหนี้ (Invoices)

**หน้าที่:** สร้างใบแจ้งหนี้ PDF รายเดือนสำหรับค่าเช่า

**ข้อมูลที่เก็บ:**
- เลขที่ใบแจ้งหนี้ (อัตโนมัติ)
- ชื่อร้าน
- สาขา
- เดือน (เช่น ตุลาคม 2568)
- จำนวนเงิน (คำนวณอัตโนมัติจากสัญญาเช่า)
- ครบกำหนดชำระ
- สถานะ (ชำระแล้ว / ค้างชำระ)
- วันที่ชำระ (ถ้าชำระแล้ว)
- ประเภทค่าเช่า (คงที่ / % จากยอดขาย)
- ยอดขายและ % (สำหรับค่าเช่าผันแปร)

**Flow การทำงาน:**
1. สร้างใบแจ้งหนี้:
   - เลือกร้านและสาขา
   - ระบุเดือน
   - ระบุครบกำหนดชำระ
   - เลือกประเภทค่าเช่า
   - ระบุจำนวนเงิน (ระบบจะคำนวณอัตโนมัติจากสัญญาเช่า)
   - สร้างใบแจ้งหนี้
2. ดาวน์โหลด PDF:
   - เลือกใบแจ้งหนี้ที่ต้องการ
   - ดาวน์โหลดเป็น PDF
3. กรองและค้นหา:
   - ค้นหาตามชื่อร้านหรือเลขที่ใบแจ้งหนี้
   - กรองตามสถานะ
   - กรองตามสาขา

**สถิติที่แสดง:**
- ใบแจ้งหนี้ทั้งหมด
- ยอดรวม
- ค้างชำระ (จำนวนเงินและจำนวนใบ)
- ชำระแล้ว (จำนวนใบ)

---

### 6. การชำระเงิน (Payments)

**หน้าที่:** บันทึกการชำระเงินค่าเช่า

**ข้อมูลที่เก็บ:**
- เลขที่ใบแจ้งหนี้
- ชื่อร้าน
- สาขา
- จำนวนเงิน
- วันที่ชำระ
- วิธีชำระ (เงินสด / โอน / หักจากยอดขาย)
- สถานะ (ชำระแล้ว)

**Flow การทำงาน:**
1. บันทึกการชำระเงิน:
   - ระบุเลขที่ใบแจ้งหนี้
   - เลือกร้านและสาขา
   - ระบุจำนวนเงินและวันที่ชำระ
   - เลือกวิธีชำระ (เงินสด, โอน, หักจากยอดขาย)
   - บันทึกการชำระเงิน
2. ระบบส่งข้อมูลไป M6 อัตโนมัติ:
   - เดบิต: เงินสด (หรือบัญชีธนาคาร)
   - เครดิต: รายได้ค่าเช่า (4110)
3. กรองและค้นหา:
   - ค้นหาตามชื่อร้านหรือเลขที่ใบแจ้งหนี้
   - กรองตามวิธีชำระ
   - กรองตามสาขา

**สถิติที่แสดง:**
- รายการทั้งหมด
- ยอดรวม
- เงินสด (ยอดรวม)
- หักจากยอดขาย (ยอดรวม)

**การเชื่อมต่อกับ M6:**
- ระบบจะส่งข้อมูลการชำระเงินไป M6 (Accounting System) อัตโนมัติ
- เดบิต: เงินสด (หรือบัญชีธนาคาร)
- เครดิต: รายได้ค่าเช่า (4110)

---

### 7. ใบสำคัญจ่าย (Payment Vouchers)

**หน้าที่:** ออกใบสำคัญจ่ายสำหรับค่าเช่าที่ปั๊มจ่ายออก

**ข้อมูลที่เก็บ:**
- เลขที่ใบสำคัญจ่าย
- วันที่
- ผู้รับเงิน (เจ้าของที่ดิน, เจ้าของป้ายโฆษณา, ฯลฯ)
- รายละเอียด (ค่าเช่าที่ดิน, ค่าเช่าป้ายโฆษณา, ฯลฯ)
- สาขา
- จำนวนเงิน
- วิธีชำระ (โอน, เช็ค, เงินสด)
- บัญชีธนาคาร (ถ้าโอน)
- สถานะ (อนุมัติแล้ว / รออนุมัติ)
- ผู้อนุมัติและวันที่อนุมัติ (ถ้าอนุมัติแล้ว)

**Flow การทำงาน:**
1. สร้างใบสำคัญจ่าย:
   - ระบุผู้รับเงินและรายละเอียด
   - เลือกสาขา
   - ระบุจำนวนเงินและวิธีชำระ
   - สร้างใบสำคัญจ่าย
2. อนุมัติใบสำคัญจ่าย:
   - ตรวจสอบรายละเอียด
   - อนุมัติหรือปฏิเสธ
3. ดาวน์โหลด PDF:
   - เลือกใบสำคัญจ่ายที่ต้องการ
   - ดาวน์โหลดเป็น PDF
4. กรอง:
   - กรองตามสถานะ (อนุมัติแล้ว / รออนุมัติ)

**สถิติที่แสดง:**
- ใบสำคัญจ่ายทั้งหมด
- ยอดรวม
- รออนุมัติ (จำนวนรายการ)

---

### 8. ใบเสร็จรับเงิน (Receipts)

**หน้าที่:** ออกใบเสร็จรับเงินให้เจ้าของที่ดิน สำหรับค่าเช่าที่ปั๊มจ่ายออก

**ข้อมูลที่เก็บ:**
- เลขที่ใบเสร็จรับเงิน
- วันที่
- ผู้จ่ายเงิน (เจ้าของที่ดิน, เจ้าของป้ายโฆษณา, ฯลฯ)
- รายละเอียด (รับค่าเช่าที่ดิน, รับค่าเช่าป้ายโฆษณา, ฯลฯ)
- สาขา
- จำนวนเงิน
- วิธีชำระ (โอน, เช็ค, เงินสด)
- บัญชีธนาคาร (ถ้าโอน)
- สถานะ (ออกแล้ว)
- ผู้ออกใบเสร็จ

**Flow การทำงาน:**
1. ออกใบเสร็จรับเงิน:
   - ระบุผู้จ่ายเงินและรายละเอียด
   - เลือกสาขา
   - ระบุจำนวนเงินและวิธีชำระ
   - ออกใบเสร็จรับเงิน
2. ดาวน์โหลด PDF:
   - เลือกใบเสร็จที่ต้องการ
   - ดาวน์โหลดเป็น PDF

**สถิติที่แสดง:**
- ใบเสร็จทั้งหมด
- ยอดรวม
- ออกแล้ว (จำนวนใบเสร็จ)

---

### 9. ค่าเช่าภายนอก (External Rent)

**หน้าที่:** บันทึกค่าเช่าที่ปั๊มไปเช่าที่อื่น (เช่น ป้ายโฆษณา, ที่ดิน)

**ข้อมูลที่เก็บ:**
- ประเภท (ที่ดิน, ป้ายโฆษณา, อื่นๆ)
- รายละเอียด (เช่น เช่าที่ดินสำหรับป้ายโฆษณา)
- สาขา
- จำนวนเงิน
- ความถี่ (รายเดือน, รายปี)
- ครบกำหนดชำระ
- สถานะ (รอชำระ / ชำระแล้ว)
- วันที่ชำระ (ถ้าชำระแล้ว)

**Flow การทำงาน:**
1. บันทึกค่าเช่าภายนอก:
   - เลือกประเภท (ที่ดิน, ป้ายโฆษณา, อื่นๆ)
   - ระบุรายละเอียด
   - เลือกสาขา
   - ระบุจำนวนเงินและความถี่
   - ระบุครบกำหนดชำระ
   - บันทึกค่าเช่าภายนอก
2. แจ้งเตือนก่อนครบกำหนด:
   - ระบบจะแจ้งเตือนก่อนครบกำหนด 7 วัน
3. ทำเครื่องหมายว่าชำระแล้ว:
   - เลือกรายการที่ชำระแล้ว
   - ทำเครื่องหมายว่าชำระแล้ว
4. ออกใบสำคัญจ่าย:
   - เลือกรายการที่ต้องการออกใบสำคัญจ่าย
   - ออกใบสำคัญจ่าย
5. แก้ไขและลบ:
   - แก้ไขรายละเอียดค่าเช่าภายนอก
   - ลบรายการที่ไม่ต้องการ
6. กรองและค้นหา:
   - ค้นหาตามประเภทหรือรายละเอียด
   - กรองตามสาขา
   - กรองตามสถานะ

**สถิติที่แสดง:**
- รายการทั้งหมด
- ค่าใช้จ่ายรวม (บาท/เดือน)
- รอชำระ (จำนวนเงินและจำนวนรายการ)
- ใกล้ครบกำหนด (จำนวนรายการภายใน 7 วัน)

**แจ้งเตือน:**
- ระบบจะแสดงแจ้งเตือนสำหรับรายการที่ใกล้ครบกำหนดชำระ (ภายใน 7 วัน)
- แสดงจำนวนวันที่เหลือ

---

### 10. แจ้งเตือน (Lease Alerts)

**หน้าที่:** แจ้งเตือนสัญญาเช่าใกล้หมดและครบกำหนดชำระล่วงหน้า

**ข้อมูลที่แสดง:**
- สัญญาใกล้หมด:
  - ชื่อร้านและสาขา
  - ประเภทสัญญา (ให้เช่า / เป็นผู้เช่า)
  - วันหมดอายุ
  - จำนวนวันที่เหลือ
  - สถานะ (ด่วน / เตือน / แจ้งเตือน)
  - อัตราค่าเช่า
- ครบกำหนดชำระ:
  - ชื่อร้านและสาขา
  - ประเภทสัญญา (ให้เช่า / เป็นผู้เช่า)
  - ครบกำหนดชำระ
  - จำนวนวันที่เหลือ
  - สถานะ (ด่วน / เตือน / แจ้งเตือน)
  - ยอดที่ต้องชำระ

**Flow การทำงาน:**
1. ระบบตรวจสอบสัญญาเช่าและใบแจ้งหนี้
2. คำนวณจำนวนวันที่เหลือก่อนหมดอายุหรือครบกำหนดชำระ
3. แสดงแจ้งเตือนตามระดับความเร่งด่วน:
   - ด่วน: เหลือ ≤ 7 วัน
   - เตือน: เหลือ 8-30 วัน
   - แจ้งเตือน: เหลือ > 30 วัน
4. การดำเนินการ:
   - ต่อสัญญา (สำหรับสัญญาใกล้หมด)
   - ชำระเงิน (สำหรับครบกำหนดชำระ)

**สถิติที่แสดง:**
- ด่วน (จำนวนรายการ)
- สัญญาใกล้หมด (จำนวนรายการ)
- ครบกำหนดชำระ (จำนวนรายการ)
- รวมทั้งหมด (จำนวนรายการ)

**ตั้งค่าแจ้งเตือน:**
- แจ้งเตือนสัญญาใกล้หมด: 60 / 30 / 7 วัน
- แจ้งเตือนครบกำหนดชำระ: 30 / 15 / 7 วัน
- ช่องทางแจ้งเตือน: อีเมล, Line, SMS

---

### 11. รายงานอายุหนี้ (Aging Report)

**หน้าที่:** รายงานอายุหนี้ค่าเช่า (Aging Report) เพื่อบริหารสภาพคล่อง

**ข้อมูลที่แสดง:**
- ลูกหนี้ค่าเช่า (Receivables):
  - 0-30 วัน
  - 31-60 วัน
  - 61-90 วัน
  - เกิน 90 วัน
- เจ้าหนี้ค่าเช่า (Payables):
  - 0-30 วัน
  - 31-60 วัน
  - 61-90 วัน
  - เกิน 90 วัน
- รายละเอียดตามอายุหนี้:
  - ร้าน/ผู้เช่า
  - สาขา
  - ยอดหนี้
  - อายุหนี้ (วัน)
  - สถานะ (ปกติ / เตือน / เกินกำหนด)

**Flow การทำงาน:**
1. เลือกประเภทรายงาน (ลูกหนี้ / เจ้าหนี้)
2. ระบบคำนวณอายุหนี้ตามวันที่ครบกำหนดชำระ
3. แสดงผลแยกตามช่วงอายุหนี้
4. แสดงรายละเอียดแต่ละรายการพร้อมสถานะ

**สถิติที่แสดง:**
- 0-30 วัน (ยอดเงินและ % ของทั้งหมด)
- 31-60 วัน (ยอดเงินและ % ของทั้งหมด)
- 61-90 วัน (ยอดเงินและ % ของทั้งหมด)
- เกิน 90 วัน (ยอดเงินและ % ของทั้งหมด)
- ยอดรวมทั้งหมด

---

### 12. OCR สแกน (OCR Scan)

**หน้าที่:** ถ่ายรูปบิล → ดึงข้อมูลอัตโนมัติ (สัญญาเช่า, ใบแจ้งหนี้, สลิปโอน)

**ข้อมูลที่เก็บ:**
- ชื่อไฟล์
- วันที่สแกน
- ประเภท (สัญญาเช่า, ใบแจ้งหนี้, สลิปโอน)
- ข้อมูลที่ดึงได้ (ขึ้นอยู่กับประเภท):
  - สัญญาเช่า: ชื่อร้าน, สาขา, วันที่เริ่ม, วันที่สิ้นสุด, อัตราค่าเช่า, ประเภทค่าเช่า
  - ใบแจ้งหนี้: ชื่อร้าน, สาขา, จำนวนเงิน, ครบกำหนดชำระ
  - สลิปโอน: ชื่อร้าน, จำนวนเงิน, วันที่ชำระ, บัญชีธนาคาร
- สถานะ (สำเร็จ / ผิดพลาด)
- ความมั่นใจ (Confidence %)
- ข้อผิดพลาด (ถ้ามี)

**Flow การทำงาน:**
1. อัปโหลดไฟล์:
   - เลือกไฟล์ (PDF, JPG, PNG)
   - อัปโหลดไฟล์
2. ระบบสแกนและดึงข้อมูล:
   - ระบบใช้ OCR (Optical Character Recognition) สแกนไฟล์
   - ดึงข้อมูลตามประเภทไฟล์
   - แสดงความมั่นใจ (Confidence %)
3. ตรวจสอบและใช้ข้อมูล:
   - ตรวจสอบข้อมูลที่ดึงได้
   - แก้ไขข้อมูลถ้าจำเป็น
   - ใช้ข้อมูล (สร้างสัญญาเช่า, ใบแจ้งหนี้, หรือบันทึกการชำระเงิน)
4. กรอง:
   - กรองตามประเภท

**สถิติที่แสดง:**
- ไฟล์ทั้งหมด
- สำเร็จ (จำนวนไฟล์)
- ผิดพลาด (จำนวนไฟล์)
- เฉลี่ยความมั่นใจ (%)

**รองรับไฟล์:**
- PDF
- JPG
- PNG

---

### 13. รายงาน (Reports)

**หน้าที่:** รายงานรายได้ค่าเช่ารายปั๊ม / รายเดือน / รายร้าน และรายงานค่าใช้จ่ายค่าเช่าภายนอกแยกตามปั๊ม

**ข้อมูลที่แสดง:**
- รายงานค่าเช่า:
  - รายได้ค่าเช่า (5 ปั๊ม)
  - ค่าเช่าภายนอก
  - กำไรสุทธิ
  - การเปลี่ยนแปลงจากเดือนที่แล้ว
- รายได้ค่าเช่าแยกตามร้าน:
  - ชื่อร้าน
  - จำนวนเงิน
  - % ของรายได้ทั้งหมด
  - กราฟแสดงสัดส่วน
- รายได้ค่าเช่าแยกตามปั๊ม:
  - ชื่อสาขา
  - จำนวนเงิน
  - กราฟแสดงสัดส่วน

**Flow การทำงาน:**
1. เลือกสาขา (ทั้งหมด หรือสาขาเฉพาะ)
2. เลือกช่วงเวลา (วันนี้, สัปดาห์นี้, เดือนนี้, ปีนี้)
3. ระบบคำนวณและแสดงรายงาน
4. ส่งออกรายงาน (PDF, Excel)

**การกรอง:**
- สาขา (ทั้งหมด, สำนักงานใหญ่, สาขา A, สาขา B, สาขา C, สาขา D)
- ช่วงเวลา (วันนี้, สัปดาห์นี้, เดือนนี้, ปีนี้)

---

### 14. ตั้งค่า (Settings)

**หน้าที่:** จัดการการตั้งค่าสำหรับโมดูลจัดการพื้นที่เช่า (M2)

**การตั้งค่าที่มี:**
- การตั้งค่าการแจ้งเตือน:
  - แจ้งเตือนหนี้ค้างชำระ (7, 15, 30 วัน)
  - คำนวณค่าเช่าอัตโนมัติจากสัญญาเช่า
- การเชื่อมต่อโมดูล:
  - M1: ดึงยอดขายร้าน → คำนวณ % ค่าเช่า
  - M6: ส่งค่าเช่าเข้า → รายได้/ค่าใช้จ่าย
  - M7: แสดงในแดชบอร์ดรวม

**Flow การทำงาน:**
1. ตั้งค่าการแจ้งเตือน:
   - กำหนดวันแจ้งเตือนหนี้ค้างชำระ
   - เปิด/ปิดการคำนวณค่าเช่าอัตโนมัติ
2. ตั้งค่าการเชื่อมต่อโมดูล:
   - เปิด/ปิดการเชื่อมต่อกับ M1
   - เปิด/ปิดการเชื่อมต่อกับ M6
   - เปิด/ปิดการเชื่อมต่อกับ M7
3. บันทึกการตั้งค่า

---

## Flow การทำงานหลักของระบบ

### 1. การสร้างสัญญาเช่าและออกใบแจ้งหนี้

1. สร้างสัญญาเช่า:
   - ระบุร้าน, สาขา, ระยะเวลา, ประเภทค่าเช่า, อัตราค่าเช่า
   - บันทึกสัญญาเช่า
2. สร้างใบแจ้งหนี้รายเดือน:
   - ระบบคำนวณค่าเช่าอัตโนมัติจากสัญญาเช่า
   - ถ้าเป็นค่าเช่าผันแปร: ระบบดึงยอดขายจาก M1 และคำนวณค่าเช่า
   - สร้างใบแจ้งหนี้ PDF
3. ส่งใบแจ้งหนี้ให้ผู้เช่า

### 2. การชำระเงินและบันทึกบัญชี

1. บันทึกการชำระเงิน:
   - ระบุเลขที่ใบแจ้งหนี้, จำนวนเงิน, วันที่ชำระ, วิธีชำระ
   - บันทึกการชำระเงิน
2. ระบบส่งข้อมูลไป M6 อัตโนมัติ:
   - เดบิต: เงินสด (หรือบัญชีธนาคาร)
   - เครดิต: รายได้ค่าเช่า (4110)
3. อัปเดตสถานะใบแจ้งหนี้เป็น "ชำระแล้ว"

### 3. การจัดการค่าเช่าภายนอก

1. บันทึกค่าเช่าภายนอก:
   - ระบุประเภท, รายละเอียด, สาขา, จำนวนเงิน, ความถี่, ครบกำหนดชำระ
   - บันทึกค่าเช่าภายนอก
2. แจ้งเตือนก่อนครบกำหนด:
   - ระบบแจ้งเตือนก่อนครบกำหนด 7 วัน
3. ออกใบสำคัญจ่าย:
   - เลือกรายการที่ต้องการออกใบสำคัญจ่าย
   - ออกใบสำคัญจ่าย
4. ทำเครื่องหมายว่าชำระแล้ว:
   - เลือกรายการที่ชำระแล้ว
   - ทำเครื่องหมายว่าชำระแล้ว

### 4. การแจ้งเตือนและติดตาม

1. ระบบตรวจสอบสัญญาเช่าและใบแจ้งหนี้:
   - คำนวณจำนวนวันที่เหลือก่อนหมดอายุหรือครบกำหนดชำระ
2. แสดงแจ้งเตือน:
   - สัญญาใกล้หมด (60, 30, 7 วัน)
   - ครบกำหนดชำระ (30, 15, 7 วัน)
   - หนี้ค้างชำระ (7, 15, 30 วัน)
3. ดำเนินการตามแจ้งเตือน:
   - ต่อสัญญา (สำหรับสัญญาใกล้หมด)
   - ชำระเงิน (สำหรับครบกำหนดชำระ)

### 5. การใช้ OCR สแกน

1. อัปโหลดไฟล์:
   - เลือกไฟล์ (PDF, JPG, PNG)
   - อัปโหลดไฟล์
2. ระบบสแกนและดึงข้อมูล:
   - ระบบใช้ OCR สแกนไฟล์
   - ดึงข้อมูลตามประเภทไฟล์
3. ตรวจสอบและใช้ข้อมูล:
   - ตรวจสอบข้อมูลที่ดึงได้
   - แก้ไขข้อมูลถ้าจำเป็น
   - ใช้ข้อมูล (สร้างสัญญาเช่า, ใบแจ้งหนี้, หรือบันทึกการชำระเงิน)

---

## ข้อมูลหลักที่ระบบจัดการ

### 1. สัญญาเช่า
- ชื่อร้าน, สาขา, ระยะเวลา, ประเภทค่าเช่า, อัตราค่าเช่า, สถานะ

### 2. ใบแจ้งหนี้
- เลขที่ใบแจ้งหนี้, ร้าน, สาขา, เดือน, จำนวนเงิน, ครบกำหนดชำระ, สถานะ, วันที่ชำระ

### 3. การชำระเงิน
- เลขที่ใบแจ้งหนี้, ร้าน, สาขา, จำนวนเงิน, วันที่ชำระ, วิธีชำระ, สถานะ

### 4. ใบสำคัญจ่าย
- เลขที่ใบสำคัญจ่าย, วันที่, ผู้รับเงิน, รายละเอียด, สาขา, จำนวนเงิน, วิธีชำระ, สถานะ, ผู้อนุมัติ

### 5. ใบเสร็จรับเงิน
- เลขที่ใบเสร็จรับเงิน, วันที่, ผู้จ่ายเงิน, รายละเอียด, สาขา, จำนวนเงิน, วิธีชำระ, สถานะ, ผู้ออกใบเสร็จ

### 6. ค่าเช่าภายนอก
- ประเภท, รายละเอียด, สาขา, จำนวนเงิน, ความถี่, ครบกำหนดชำระ, สถานะ, วันที่ชำระ

### 7. แจ้งเตือน
- สัญญาใกล้หมด: ร้าน, สาขา, ประเภทสัญญา, วันหมดอายุ, จำนวนวันที่เหลือ, สถานะ
- ครบกำหนดชำระ: ร้าน, สาขา, ประเภทสัญญา, ครบกำหนดชำระ, จำนวนวันที่เหลือ, ยอดที่ต้องชำระ, สถานะ

### 8. รายงานอายุหนี้
- ลูกหนี้ค่าเช่า: ร้าน, สาขา, ยอดหนี้, อายุหนี้, สถานะ
- เจ้าหนี้ค่าเช่า: ร้าน, สาขา, ยอดหนี้, อายุหนี้, สถานะ

### 9. OCR สแกน
- ชื่อไฟล์, วันที่สแกน, ประเภท, ข้อมูลที่ดึงได้, สถานะ, ความมั่นใจ, ข้อผิดพลาด

---

## การเชื่อมต่อกับโมดูลอื่น

### 1. M1 (Gas Station System)
- **การเชื่อมต่อ:** ดึงยอดขายร้าน (เช่น Chester's) จาก M1 อัตโนมัติ
- **การใช้งาน:** คำนวณค่าเช่าผันแปรตามยอดขาย
- **ตัวอย่าง:** Chester's ขาย 500,000 บาท × 5% = 25,000 บาท (ค่าเช่า)

### 2. M6 (Accounting System)
- **การเชื่อมต่อ:** ส่งข้อมูลการชำระเงินไป M6 อัตโนมัติ
- **การใช้งาน:** บันทึกบัญชี (เดบิต: เงินสด, เครดิต: รายได้ค่าเช่า 4110)

### 3. M7 (Dashboard System)
- **การเชื่อมต่อ:** ส่งข้อมูลรายได้ค่าเช่าและค่าใช้จ่ายค่าเช่าไป M7
- **การใช้งาน:** แสดง "รายได้ค่าเช่า vs ค่าใช้จ่ายเช่า" ในแดชบอร์ดรวม

---

## หมายเหตุสำคัญ

### 1. ประเภทค่าเช่า
- **คงที่:** ระบุอัตราค่าเช่าเป็นบาท/เดือน
- **% จากยอดขาย:** ระบุ % จากยอดขาย และระบบจะดึงยอดขายจาก M1 อัตโนมัติ

### 2. การคำนวณค่าเช่าผันแปร
- ระบบจะดึงยอดขายจาก M1 อัตโนมัติทุกวัน
- คำนวณค่าเช่าตามสูตร: ยอดขาย × % = ค่าเช่า
- เปรียบเทียบกับเดือนที่แล้ว

### 3. การส่งข้อมูลไป M6
- เมื่อบันทึกการชำระเงิน ระบบจะส่งข้อมูลไป M6 อัตโนมัติ
- เดบิต: เงินสด (หรือบัญชีธนาคาร)
- เครดิต: รายได้ค่าเช่า (4110)

### 4. การแจ้งเตือน
- สัญญาใกล้หมด: แจ้งเตือน 60, 30, 7 วัน
- ครบกำหนดชำระ: แจ้งเตือน 30, 15, 7 วัน
- หนี้ค้างชำระ: แจ้งเตือน 7, 15, 30 วัน

### 5. OCR สแกน
- รองรับไฟล์: PDF, JPG, PNG
- ประเภทที่รองรับ: สัญญาเช่า, ใบแจ้งหนี้, สลิปโอน
- แสดงความมั่นใจ (Confidence %) และข้อผิดพลาด (ถ้ามี)

### 6. รายงานอายุหนี้
- แยกตามช่วงอายุหนี้: 0-30 วัน, 31-60 วัน, 61-90 วัน, เกิน 90 วัน
- แสดง % ของแต่ละช่วงอายุหนี้
- แสดงรายละเอียดแต่ละรายการพร้อมสถานะ

### 7. ใบสำคัญจ่ายและใบเสร็จรับเงิน
- ใบสำคัญจ่าย: สำหรับค่าเช่าที่ปั๊มจ่ายออก
- ใบเสร็จรับเงิน: ให้เจ้าของที่ดิน สำหรับค่าเช่าที่ปั๊มจ่ายออก
- ต้องอนุมัติก่อนออกใบสำคัญจ่าย

### 8. ค่าเช่าภายนอก
- บันทึกค่าเช่าที่ปั๊มไปเช่าที่อื่น (เช่น ป้ายโฆษณา, ที่ดิน)
- แจ้งเตือนก่อนครบกำหนด 7 วัน
- สามารถออกใบสำคัญจ่ายได้

---

## สรุป

ระบบจัดการพื้นที่เช่า (M2) เป็นระบบที่ครอบคลุมการจัดการค่าเช่าพื้นที่ทั้งหมด ตั้งแต่การสร้างสัญญาเช่า การออกใบแจ้งหนี้ การชำระเงิน การจัดการค่าเช่าภายนอก การแจ้งเตือน และรายงานต่างๆ โดยมีการเชื่อมต่อกับโมดูลอื่น (M1, M6, M7) เพื่อให้การทำงานเป็นไปอย่างราบรื่นและมีประสิทธิภาพ

